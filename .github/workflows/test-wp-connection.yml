name: Test WordPress Connection

on:
  workflow_dispatch:

jobs:
  test-connection:
    name: Test WP Connection
    runs-on: ubuntu-latest

    steps:
      - name: Test DNS resolution
        run: nslookup maketocreate.com

      - name: Test basic connectivity (no auth)
        run: |
          curl -v --max-time 10 \
            "https://maketocreate.com/wp-json/wp/v2/posts?per_page=1" \
            2>&1 || echo "CURL FAILED with exit code $?"

      - name: Test with Basic Auth
        env:
          WP_URL: ${{ secrets.WP_URL }}
          WP_USERNAME: ${{ secrets.WP_USERNAME }}
          WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
        run: |
          echo "Testing: ${WP_URL}/wp-json/wp/v2/posts?per_page=1"
          curl -v --max-time 10 \
            -u "${WP_USERNAME}:${WP_APP_PASSWORD}" \
            "${WP_URL}/wp-json/wp/v2/posts?per_page=1" \
            2>&1 || echo "CURL FAILED with exit code $?"

      - name: Show runner IP
        run: curl -s https://ifconfig.me
